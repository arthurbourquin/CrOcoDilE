<!DOCTYPE html>
<html lang="en">
<head>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:ital,wght@0,100..700;1,100..700&family=Roboto+Slab:wght@100..900&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:ital,wght@0,100..700;1,100..700&family=Roboto+Slab:wght@100..900&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:ital,wght@0,100..700;1,100..700&family=Roboto+Slab:wght@100..900&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>QCM</title>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.0/es5/tex-mml-chtml.js"></script>

<style>
body {
	font-family: Roboto Slab;
    font-weight: 400;
    color: #ddd;
    background: #222;
    text-align: center;
}
#question {
	margin: 40px 0px 20px 0px;
    font-size: 22px;
    }
.textAnswer {
    border: 1px solid #777;	
    font-size: 18px;
    cursor: pointer;
    display: inline-block;
    margin: 10px;
    padding: 20px;
	}
.imgAnswer {
    width: 150px;
    height: auto;
    margin: 0 5px; /* Set horizontal margin to ensure proper spacing */
    padding: 20px;
    display: inline-block;
	}
.latexAnswer {
    border: 1px solid #777;	
    font-size: 22px;
    cursor: pointer;
    display: inline-block;
    margin: 10px;
    padding: 20px;
	}
#hud {
	margin-top: 20px;
    font-family: Roboto Mono;
    font-size: 18px;
    opacity: 0.2;
    }
h1 {
    font-weight: 900;
    opacity: 0.07;
    }
</style>

</head>

<body>
    <h1>Q C M</h1>
    <div id="hud">[ Score: <span id="score"></span> ] [ Time: <span id="timer"></span> ]</div>
    <div id="question">Loading question...</div>
    <div id="answers">salut</div>

    <script>
        const questions = [
            {
                question: "What is the capital of Slip?",
                answers: [
                    { type: "text", content: "Bite", correct: true },
                    { type: "text", content: "Nombril", correct: false },
                    { type: "text", content: "Pied", correct: false },
                    { type: "text", content: "Dent", correct: false }
                ]
            },
            {
                question: "Salut",
                answers: [
                    { type: "text", content: "Ca va ?", correct: true },
                    { type: "text", content: "Va chier", correct: false },
                    { type: "text", content: "D'accord", correct: false },
                    { type: "text", content: "Le Père Noël", correct: false }
                ]
            },
            {
            question: "Un carré ça a :",
                answers: [
                    { type: "text", content: "des côtés", correct: true },
                    { type: "text", content: "Aucun système de reproduction digne de ce nom", correct: false },
                    { type: "text", content: "D'accord", correct: false },
                    { type: "text", content: "Le Père Noël", correct: false }
                ]
            },
            {
                question: "Which image shows a Tohm?",
                answers: [
                    { type: "image", content: "https://www.arthurbourquin.ch/OuaisLesMedias/XWing.png", correct: false },
                    { type: "image", content: "https://www.arthurbourquin.ch/OuaisLesMedias/Stars.png", correct: false },
                    { type: "image", content: "https://www.arthurbourquin.ch/OuaisLesMedias/PhoTohm.png", correct: true },
                    { type: "image", content: "https://www.arthurbourquin.ch/OuaisLesMedias/XWing.png", correct: false }
                ]
            },
            {
                question: "\\( \\sin\\left(\\frac{\\pi}{3}\\right) \\)",
                answers: [
                    { type: "latex", content: "\\( \\sin(\\pi) \\)", correct: false },
                    { type: "latex", content: "\\( \\sin\\left(\\frac{\\pi}{2}\\right) \\)", correct: false },
                    { type: "latex", content: "\\( \\sin\\left(\\frac{\\pi}{3}\\right) \\)", correct: false },
                    { type: "latex", content: "\\( \\sin\\left(\\frac{\\pi}{4}\\right) \\)", correct: false },
                    { type: "latex", content: "\\( \\sin\\left(\\frac{\\pi}{6}\\right) \\)", correct: false },
                    { type: "latex", content: "\\( \\sin(0) \\)", correct: false },
                    { type: "latex", content: "\\( \\cos(\\pi) \\)", correct: false },
                    { type: "latex", content: "\\( \\cos\\left(\\frac{\\pi}{2}\\right) \\)", correct: false },
                    { type: "latex", content: "\\( \\cos\\left(\\frac{\\pi}{3}\\right) \\)", correct: false },
                    { type: "latex", content: "\\( \\cos\\left(\\frac{\\pi}{4}\\right) \\)", correct: false },
                    { type: "latex", content: "\\( \\cos\\left(\\frac{\\pi}{6}\\right) \\)", correct: false },
                    { type: "latex", content: "\\( \\cos(0) \\)", correct: false },
                    { type: "latex", content: "\\( \\tan(\\pi) \\)", correct: false },
                    { type: "latex", content: "\\( \\tan\\left(\\frac{\\pi}{2}\\right) \\)", correct: false },
                    { type: "latex", content: "\\( \\tan\\left(\\frac{\\pi}{3}\\right) \\)", correct: false },
                    { type: "latex", content: "\\( \\tan\\left(\\frac{\\pi}{4}\\right) \\)", correct: false },
                    { type: "latex", content: "\\( \\tan\\left(\\frac{\\pi}{6}\\right) \\)", correct: false },
                    { type: "latex", content: "\\( \\tan(0) \\)", correct: false }
                ]
            }
        ];

        let score = 0;
        let time = 0;
        let interval;
        let questionIndex = 0;
        let previousQuestions = {};

        function startGame() {
            questionIndex = 0;
            score = 0;
            time = 0;
            previousQuestions = {};
            interval = setInterval(updateTimer, 1000);
            nextQuestion();
        }

        function nextQuestion() {
            const availableQuestions = questions.map((q, index) => ({
                ...q,
                index,
                weight: previousQuestions[index] ? (previousQuestions[index].correct ? 1 : 3) : 2
            }));
            const totalWeight = availableQuestions.reduce((total, q) => total + q.weight, 0);
            const random = Math.random() * totalWeight;

            let runningTotal = 0;
            let selectedQuestion = availableQuestions[0];

            for (let q of availableQuestions) {
                runningTotal += q.weight;
                if (random <= runningTotal) {
                    selectedQuestion = q;
                    break;
                }
            }

            displayQuestion(selectedQuestion);
            questionIndex = selectedQuestion.index;
        }

function displayQuestion(q) {
    document.getElementById("question").innerHTML = q.question;
    MathJax.typesetPromise([document.getElementById("question")]).then(() => {
        const answersDiv = document.getElementById("answers");
        answersDiv.innerHTML = "";

        // Shuffle answers
        const shuffledAnswers = q.answers.slice(); // Create a copy of the array
        for (let i = shuffledAnswers.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [shuffledAnswers[i], shuffledAnswers[j]] = [shuffledAnswers[j], shuffledAnswers[i]];
        }

        shuffledAnswers.forEach((a) => {
            const answerElement = document.createElement("div");
            if (a.type === "text") {
                answerElement.textContent = a.content;
                answerElement.className = 'textAnswer';
            } else if (a.type === "image") {
                const img = document.createElement("img");
                img.src = a.content;
                answerElement.appendChild(img);
                answerElement.className = 'imgAnswer';
                img.className = 'imgAnswer';
            } else if (a.type === "latex") {
                answerElement.innerHTML = a.content;
                answerElement.className = 'latexAnswer';
            }
            answerElement.addEventListener("click", () => checkAnswer(a.correct));
            answersDiv.appendChild(answerElement);
        });

        // Process LaTeX in answers
        MathJax.typesetPromise([answersDiv]).catch((err) => console.log('MathJax error:', err));
    });
}



        function checkAnswer(isCorrect) {
            if (isCorrect) {
                score++;
            } else {
                score--;
            }

            previousQuestions[questionIndex] = { correct: isCorrect };
            updateScore();
            nextQuestion();
        }

        function updateScore() {
            const absScore = Math.abs(score);
            const scoreSign = score >= 0 ? '0' : '-';
            const formattedScore = absScore.toString().padStart(3, '0');
            document.getElementById("score").textContent = `${scoreSign}${formattedScore}`;
        }



        function updateTimer() {
            time++;
            const formattedTime = time.toString().padStart(3, '0');
            document.getElementById("timer").textContent = `${formattedTime}`;
        }

        startGame();
        updateScore();
        updateTimer();
    </script>
</body>
</html>
